/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: s1k
@author: s1k
@tags: []
@addedOn: 2024-00-00
*/
/*
 __Game Setup__
*/

// Define the player, key, door, wall, and floor
const player = "p";
const key = "k";
const door = "d";
const wall = "w";
const floor = "f";

// Create the visual representations of the game elements
setLegend(
  [player, bitmap`
................
................
.....00000......
....0333330.....
...033333330....
..03333333330...
..03330003330...
..03330003330...
..03333333330...
...033333330....
....0333330.....
.....03330......
......000.......
................
................
................`],
  [key, bitmap`
................
................
....000000......
...03333330.....
..0333333330....
..0330000330....
..0330000330....
..0330000330....
..0333333330....
..0333333330....
...03333330.....
....000000......
................
................
................
................`],
  [door, bitmap`
................
................
..5555555555....
..5........5....
..5........5....
..5........5....
..5........5....
..5........5....
..5........5....
..5........5....
..5........5....
..5555555555....
................
................
................
................`],
  [wall, bitmap`
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555`],
  [floor, bitmap`
................
................
................
................
................
................
................
................
................
................
................
................
................
................
................
................
................`]
);

// Define the level map
const levels = [
  map`
wwwwwwwww
w...w...w
w.p.w.k.w
w...w...w
wwwww.w.w
w.....w.w
w.w.w.w.w
w.w...w.d
wwwwwwwww`,
  map`
wwwwwwwww
w.......w
w...p...w
w.......w
wwwwww..w
w.k.....w
w.....w.w
w.w...w.d
wwwwwwwww`,
];

// Set the current level
let level = 0;
setMap(levels[level]);

// Variable to track if the player has the key
let hasKey = false;

// Player movement
onInput("a", () => {
  getFirst(player).x -= 1;
});

onInput("d", () => {
  getFirst(player).x += 1;
});

onInput("w", () => {
  getFirst(player).y -= 1;
});

onInput("s", () => {
  getFirst(player).y += 1;
});

// Game update loop
function update() {
  const playerSprite = getFirst(player);
  
  // Check if the player collects the key
  if (tilesWith(playerSprite, key).length) {
    hasKey = true;
    removeTile(playerSprite.x, playerSprite.y, key);
  }

  // Check if the player reaches the door
  if (tilesWith(playerSprite, door).length && hasKey) {
    level++;
    if (level >= levels.length) {
      addText("You Win!", { x: 5, y: 5 });
    } else {
      setMap(levels[level]);
      hasKey = false; // Reset key status for next level
    }
  }

  // Prevent player from walking through walls
  if (tilesWith(playerSprite, wall).length) {
    playerSprite.x -= getInputDirection().x;
    playerSprite.y -= getInputDirection().y;
  }
}

// Run the update function repeatedly
setInterval(update, 100);
