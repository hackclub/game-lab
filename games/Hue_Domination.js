/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: Hue Domination
@author: Gus Ruben
@tags: [2-Player, Multiplayer, PVP]
@addedOn: 2024-00-00
*/

const playerRedUp = "1"
const playerRedDown = "2"
const playerRedLeft = "3"
const playerRedRight = "4"
const playerBlueUp = "5"
const playerBlueDown = "6"
const playerBlueLeft = "7"
const playerBlueRight = "8"
const paintRed = "r"
const paintRedSpecial1 = "R"
const paintRedSpecial2 = "t"
const paintRedSpecial3 = "T"
const paintBlue = "b"
const paintBlueSpecial1 = "B"
const paintBlueSpecial2 = "n"
const paintBlueSpecial3 = "N"
const background = "g"

setLegend(
  [playerRedUp, bitmap`
................
..000000000000..
..066663666360..
..063333333330..
..06333333333000
..033333333330.0
..000000000000.0
...............0
.......000000000
.......0........
......0000......
......0660......
......0630......
......0330......
......0330......
......0000......` ],
  [playerRedDown, bitmap`
......0000......
......0660......
......0630......
......0330......
......0330......
......0000......
.......0........
.......000000000
...............0
..000000000000.0
..066663666360.0
..06333333333000
..063333333330..
..033333333330..
..000000000000..
................` ],
  [playerRedLeft, bitmap`
................
................
.000000.........
.066630.........
.063330.........
.063330.........
.063330...000000
.033330.00066630
.063330.0.063330
.063330.0.000000
.033330.0.......
.033330.0.......
.033330.0.......
.000000.0.......
....0...0.......
....00000.......` ],
  [playerRedRight, bitmap`
.......00000....
.......0...0....
.......0.000000.
.......0.066630.
.......0.063330.
.......0.063330.
000000.0.063330.
066630.0.033330.
06333000.063330.
000000...063330.
.........033330.
.........033330.
.........033330.
.........000000.
................
................` ],
  [playerBlueUp, bitmap`
................
..000000000000..
..077775777570..
..075555555550..
..07555555555000
..055555555550.0
..000000000000.0
...............0
.......000000000
.......0........
......0000......
......0770......
......0750......
......0550......
......0550......
......0000......` ],
  [playerBlueDown, bitmap`
......0000......
......0770......
......0750......
......0550......
......0550......
......0000......
.......0........
.......000000000
...............0
..000000000000.0
..077775777570.0
..07555555555000
..075555555550..
..055555555550..
..000000000000..
................` ],
  [playerBlueLeft, bitmap`
................
................
.000000.........
.077750.........
.075550.........
.075550.........
.075550...000000
.055550.00077750
.075550.0.075550
.075550.0.000000
.055550.0.......
.055550.0.......
.055550.0.......
.000000.0.......
....0...0.......
....00000.......` ],
  [playerBlueRight, bitmap`
.......00000....
.......0...0....
.......0.000000.
.......0.077750.
.......0.075550.
.......0.075550.
000000.0.075550.
077750.0.055550.
07555000.075550.
000000...075550.
.........055550.
.........055550.
.........055550.
.........000000.
................
................` ],
  [background, bitmap`
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2222222212121212
2222222221212121
2222222212121212
2222222221212121
2222222212121212
2222222221212121
2222222212121212
2222222221212121` ],
  [paintRed, bitmap`
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333` ],
  [paintRedSpecial1, bitmap`
3333333333333333
3399933333333333
3999933333333333
3999333333333333
3393333333333333
3333333333333333
3333333333333333
3333333333333993
3333333333339993
3333333333999993
3333333999999993
3333339999999993
3333333999999933
3333333399999333
3333333333333333
3333333333333333` ],
  [paintRedSpecial2, bitmap`
3333333333333333
3333333333333333
3333333399999333
3333333399999933
3333333999999933
3333399999999933
3333339999993333
3333333333333333
3333333333333333
3333333333333333
3333333333993333
3333333333999333
3993333333399333
3933333333333333
3333333333333333
3333333333333333` ],
  [paintRedSpecial3, bitmap`
3333333333333333
3333333333333333
3339999333333333
3339999993333333
3399999999333333
3999933333333333
3999333399993333
3999333999999333
3993333999999933
3333333333999933
3333333333399933
3333333333999933
3333333333999333
3333333339999333
3333333399333333
3333333333333333` ],
  [paintBlue, bitmap`
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial1, bitmap`
5555555555555555
5555555555555555
5555577757777555
5557777777775555
5557777777775555
5557777777555555
5557757775555555
5557555555555577
5555555555555777
5555555555555775
5555555555555555
5555555577555555
5555777777755555
5557777777555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial2, bitmap`
5555555555555555
5557557555555555
5557777775555555
5777777777555555
5577777777555555
5577777777555555
5557777555555555
5555575555555555
5555555555555775
5555555555555775
5555555555555555
5577555555555555
5577555555555555
5575555555555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial3, bitmap`
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555775755555
5555555777777755
5555555577777775
5555555557777775
5555555777777775
5555555577777555
5555555577755555
5577555555555555
5777555555555555
5777555555555555
5575555555555555
5555555555555555` ],
)


let level = 0
const levels = [
  map`
.........6
..........
..........
..........
..........
..........
..........
1.........`
]

setBackground(background)
setMap(levels[level])

// Create an array the size of the game board, to keep track of paint
let canvas = []
for (let i = 0; i < 10; i++) {
  canvas.push(Array(8).fill(""))
}

// the canvas should start off painted where the players spawn
canvas[9][0] = "b"
canvas[0][7] = "r"
addSprite(9, 0, "b")
addSprite(0, 7, "r")


const spritesRed = ["1", "2", "3", "4"]
const controlsRed = {
  "w": {
    func: p => p.y -= 1,
    type: "1",
  },
  "s": {
    func: p => p.y += 1,
    type: "2",
  },
  "a": {
    func: p => p.x -= 1,
    type: "3",
  },
  "d": {
    func: p => p.x += 1,
    type: "4",
  },
}

const spritesBlue = ["5", "6", "7", "8"]
const controlsBlue = {
  "i": {
    func: p => p.y -= 1,
    type: "5",
  },
  "k": {
    func: p => p.y += 1,
    type: "6",
  },
  "j": {
    func: p => p.x -= 1,
    type: "7",
  },
  "l": {
    func: p => p.x += 1,
    type: "8",
  },
}

setSolids([...spritesRed, ...spritesBlue]);

[[spritesBlue, controlsBlue, "b", ["B","n","N"]], [spritesRed, controlsRed, "r", ["R", "t", "T"]]].forEach(data => {
  const [sprites, controls, paintColor, specialPaint] = data;

  Object.keys(controls).forEach(key => {
    onInput(key, () => {
      let player;
      // find the player, regardless of what directional sprite is in use right now
      for (const sprite of sprites) {
        console.log(sprite)
        player = getFirst(sprite);
        if (player) break;
      }

      // move the player
      controls[key].func(player);
      player.type = controls[key].type;

      // color the canvas at that spot
      let currentColor = canvas[player.x][player.y]
      if (currentColor == "") {
        addSprite(player.x, player.y, paintColor)
      } else {
        for (let sprite of getTile(player.x, player.y)) {
          if (sprite.type == currentColor) {
            
            // random chance to pick a special paint sprite
            if (Math.random() < 0.5) {
              paintSprite = specialPaint[Math.floor(Math.random() * specialPaint.length)]
            } else {
              paintSprite = paintColor
            }
            
            sprite.type = paintSprite
          }
        }
      }
      canvas[player.x][player.y] = paintColor
    })
  })
})


