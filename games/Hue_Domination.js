/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: Hue Domination
@author: Gus Ruben
@tags: [2-Player, Multiplayer, PVP]
@addedOn: 2024-00-00
*/

// scales up a bitmap by 2x
function doubleBitmap(bitmap) {
    const rows = bitmap.split('\n');
    const scaledRows = [];

    for (const row of rows) {
        // horizontal
        const scaledRow = row.split('').map(char => char.repeat(2)).join('');


        // vertical
        scaledRows.push(scaledRow);
        scaledRows.push(scaledRow);
    }

    return scaledRows.join('\n');
}

// the title screen image needs to be split into 16x16 chunks
function splitBitmap(bitmap) {
    const rows = bitmap.trim().split('\n')
    const chunks = [];
    const chunkRows = rows.length / 16;
    const chunkCols = rows[0].length / 16;
  
    for (let i = 0; i < chunkRows; i++) {
        for (let j = 0; j < chunkCols; j++) {
            let chunk = [];
            for (let r = 0; r < 16; r++) {
                const rowIndex = i * 16 + r;
                const startCol = j * 16;
                const endCol = startCol + 16;
                
                chunk.push(rows[rowIndex].slice(startCol, endCol));
            }
            chunks.push(chunk.join('\n'));
        }
    }

    return chunks;
}

// dimensions need to be a multiple of 16
const titleImage = bitmap`
6666666666666666666666666666666666666666666666666666666666666666666666666666611111111111111111111111111111111111111111111111111111111111111111111111111111111111
6666666666666666666666666666666666666666666666666666666666666666666666666666661111111111111111111111111111111111111111111111111111111111111111111111111111111111
6666666666666666666666666666666666666666666666666666666666666666666666666666661111111111111111111111111111111111111111111111111111111111111111111111111111111111
6666666666666666666666666666666666666866666666666686666666668666666666666666688111111111111181111111111111111118111111111111111111111111111111111111111111111111
6666666666666666666666666666666666666686666666666888666666668688866666666666888811111111111881111111111111111818111111111111111111111111111111111111111111111111
6666666666666666666666666666666666666686666666688888866666668888866666666666888811111811111888111111111111118888811111111181111111111111111111111111111111111111
6666666666666666666666666666666666668888666666888888856666668888886666686666888818888811111888111111888111188888811111111181111111111111111111111111111111111111
6666666666666666666686666666668866668888666666888888555666668886886555588866888888888811118888111118888111188881818111111181111111111111111111111111111111111111
6666666666666666666688866666668866668888866666688888858866668888885555558888885555555551188888111558888111118811118811811181111118111111111111111111111111111111
6666666666666666666668886666668866668888866666688888888886688888855555555885555555555555558818815555888111118881818888811188118118111111111111111111111111111111
6666666666666686666660000006666866668888886666686688888886688888555555555555555555555555555588885555858811118555818888811188118888111111111111111111111111111111
6666666666666688666000000000066555555588888666686688888886688885555555555555555555555555555555888551555811185555588888811188118888811111111111111111111111111111
6666666666666688660000666600005555555555588866688888888886888885555555555555555555555555555555588881158811185555588888811888118888888000000001811111111111111111
6666666666666688800066688666000555555555555866688888888888888885555555555555555555555555555555558888888811885555588888811888118888800000000000181111111111111111
6666666666666688000666866666600555555555555566688888888888888885555555555555555555555555555555555888888811888555888888818888118888000011111100011111111111111111
6666666666666888006677666666600055555555555556688888888888888885555555555555555555555555555555555588888881888888888818888888118888001111888110001111111111111111
6666666666666888006000766666660055555555555555688555558888888888555555555555555555555555555555555558888881888888888111888855555588000001111811000111111111111111
6666666666666888000000766666660005555555555555555555555588888888855555555555555555555555555555555555888881888888888818885555555558800000111111100111111111111111
6666666866666888800000076666666005555555555555555555555558888888855555555555555555555555555555555555888888888885555558855555555555888000011111100011111111111111
6666666866666888888880076666666000555555555555555555555555888888555555555555555555555555555555555000088881888555555555555555550000000000111111140011111111111111
6666666886666866888850076666666600555555555555555555555555888880005555555555555555555555555555550000008888885555555555555555000000000011111111140011111111111111
6666666886666866688850077666666600555555555555555555555555588800000555555555555555555555555555000066000888855555555555555550000111111111111111140011111111111111
6666666886666886888800077666666600055555555555555555555555588000600055555555555555555555555550000666600888555555555555555500011111111111111111440011111111111111
6666666855666555888500777666666660000555555555555555555555588006660055555555555555555555555500060066600885555555555555555000111111111111111111440011111111111111
6666666555565555588500777666666666000055555555555555555555588006600055555555555555555555555500666006000885555555555555550001111111111111111111400011111111111111
8666666555565555588500777666666666660005555555555555555555555006600000555555555555555555555500060006005555555555555555550011111111111111111114400111181111111111
8666666855665555588500777666666666666005555555555555555555555000700000055550000055000000005550060006005555555555555555550031111111111111111114400111181111111111
8666666886666555888500777666666666666000555555000555550000000500000070005000000000000000000000000000000005555555555555500033111111111111111114400111181111111111
8666666886666888888500777666666666633300000550000055500000000050000777000000777000077770700000000000000000055555555550000331111111111111111144000111181111111111
8666666886666888888500777766666666663300000000060005000777770000077777700077777770777777770777777000777700005555555500005333113111111111111444008111181111111111
8666666888668888888800777766666666633555550000666000007787777000777777760778878770777777600788878777777777000555555000555553313311111111114444008111181111111111
8666666688668555558800077776666633335555555000660000077877770000777766607787777660777776660787777777777777700555500002255555333311111111444440008111181111111111
6666666688865555555850077777766333355555222200600000078777770007777666707877766660077766660778777777766666600050000022222255533311111114444400088111111111111111
6666666688855555555580007777773333555522222200600000778777660007776666077877666660077666667078777766666666660000002222222225553331114444444000888111111111111111
6666666688555555555555000777377335555222222200600077777766600077776667078777666070077666666078777666666666660000222222222222555333344444400001888111111111111118
6666666685555555555555500077333355552222222200000777777666600077766677077776666070077666666077776666660600600002222222222222255533134444000011888111111111111188
6666666655555555555555550000333555522222222220000077776666660077666670777766666000077666666007776666000000700002222222222222225553333000005811888111111111111188
6666666655555555555555555000003555222222222222200077776666666666666660777666666000076666666007776666000000000000222222222222225553000000055511888111181111111188
6666666655555555555555555550005552222222222222200777766666666666666660776666666000006666666007766666600077777700002222222222222555000055555511888811881111111188
6666666655555555555555555555005552222222222222200777666666666666666660766666666060066666666007766666666667776770000222222222222255005555555518888818881511111188
6666666655555555555555555555000522222222222222000777666666666666666660766666666666066666666607666666666666666660600022222222222250005555555588888818885551111188
6666686655555555555555555555500022222222222222007776666666666666666600666666666660066666666607666666666666666666660022222222222200055555555588888818881511111188
6666686885555555555555555555550002222222222222007766666666666666666600666666666660066666666606666666666666666666600000022222222000555555555588888888881111811188
6666888888555555555555555555555002222220000222007666666666666666666600666666666666666666666606666666666666666666000000002222222005555555555888888888881111881188
6666888688855555555555555555555000222200000020006666666666666666666600066666666666666666666606666666666666666606000066000222220005555555555888885818881111881188
6666886668855555555555555555555500022000660000066666666660666666666600066666666666666666666606666666666600600000000666600222200055555555555888855588881111881188
6666888688855555555555555555555550020006666000066666666600066666666600066666666666666666666006666666666000000000000066000222200555555555555588885888881111881188
6666888888855555555555555000005550000066666000066666666600066666666660066666666666666666666006666666666000067777700060002222000555555555555558888888881111888188
6666888888855555555555550000000555000006660006066666666600066666666660066666666666666666666066666666666066666667700000022220005555555555555555555888881111188888
8668888885555555555555550011100055500006000066666666666600666666666660006666666666666666666066666666666666666666660060020000055555555555555555555588881111118888
8668888855555555555555550001110055550006000006666666666600666666666660006666666666666666666066666666666666666666660000000000005555555555555555555558881111118188
8668888555555555555555555000110055555006000000666666666600666666666660006666666666666666660066666666666666666666660000000110000555555555555555555555881111118888
8668888555555555555555555500100055555006000000666666666000666666666660006066666666666666060066666666666666666666600000001111100555555555555555555555881111118888
8668888555555555555555555500000555555000000000606666666000666666666660006066666666666666000666666666666666660666600000000111000555555555555555555555881111118888
8688888555555555555555555500100555555500000000600600060000660660006660000066066666666606006666006660600660660060600000000010000000055555555555555555881111118888
8688888855555555555555000000000555500000010000600600060000600060060000000066000066666000000660000000000600060000600000000010000000000555555555555558888111118888
8888888885555555555550000000000050000000111000600000000000000060000000000066000000000000000060000001100000060000600000000000001111000055555555555588888111118888
8888888888888555555500011111110000001111111000600000011111000000011111100066000000011111110000001111111110000000600000001001111111110005555555555588888111118888
8688888888888855555000118881811000011888111100600000118811111000118818100000000000118881110000011888181111111000000000011111881111111000555555555588888111118888
8888888888888855550001181111111000118111111100000001181111111001181111110066000000181111110000018111111111111100600000001188111111111100055555555888888111118888
8888888888888885550011811111110001181111111100600011811111111110181111110000000000181111110000118111111111111100000000011811111111111110005558888881888811118888
8888888888888885500018111111110001111111111000000018111111111000181111111000000011111111110000181111111111111110000000111111111111111111005588888811188881188888
8888888888888885500118111111110001111111111100000118111111111100111111111000000111111111110001181111111111111111000000111111111111111111000588888881888881188888
8888888888888885000111111111100011111111111100000111111111111100111111111000000011111111110011111111111111111111000001111111111111111111100558888888888881188888
8888888888888850001111111111100011111111111100000111111011111100101111111100000001111111110111111111111111111111100001111111110110111111000555888888558881188888
8888888888888850011111111111111111111111111100001111110010111110101111111110000011111111010111111111111111111111100011111111010010011111005555588885555881188888
8888888888888850001111111111111111111111111100001111110000111110001111111110000011111111000111111111100101111111110011111111010000001111005555558885555881188888
8888588888880000000111111111111111111111110100001111111001111110001111111110000111111111001111111110100000111111110011111110010000000101005555558888558888188888
8885558888800000000111111111111111111111110000011111111111111111000111111111000111111111001111111110100000111111110111111110010000000001005000055888888888188888
8888588888000110000111111111111111111111110000011111111111111111000111111111001111111110001111111110100001111111110111111110000000000001000000005888888888188888
8888888888001110000111111111111111111111110000111111111111111111000011111111111111111110001111111110001101111111110111111110000000000000000011000588888888888888
8888888888001110000111111111111111111111110001111111111111111111000011111111111111111140011111111110011111111111100111111110000000011000000111100588888888888888
8888888888001100000111111111111111111111111000111111111111111111400011111111111111111440011111111111001111111111100111111111000001111100000111100588888888888188
8888868888000100500111111111100111111111111000011111111111111114400011111111111111111440011111111111111111111111100111111111111111111440000001100558888818888888
8888666888800100500011111111100011111111111000011111111111111114400011111111111111111040011111111111111111111111100111111111111111144440000000100558888818888888
8888868888800000550011111111100011111111111000011111111111111114400010111111111111114040011111111111111111111440400111111111111114444444000500100558888818888888
8888888888880008550011111111440001111111111400011111144111111114440010111111111111144040011111111111111111114440000111111111111444444444400500100558888818888588
8888888888888885550011111111440001111111111400011111444411111114440000011111111111444040011111111111111111444440400011111111144444444004000500000558888888885558
8888888888888855550011111114440001111111114440001114444001111114440040011111111144444040011111111111111114444440000041111111444444440000005500100558888888888588
8888888888888855550010111144444001111111114440001114440000111444440000011111111444404000010111111111114444444040000001111444444444440000055500000558888888888888
8888888888888555550010014444444001011111144440000144440000114444444000011111144444004040040041111444444444444040000001444444444440040055555550005558888888888888
8888888888888555550040044444444404004444444444000444440000104444444000010144444440004000000044444444444444404000000004444444440000000055555555555558888888888888
8888888888888555550040004444444004004444444440000044400000000444440000000044444440004000000000444444444440004000000004000440400000000555555555555588888888888888
8888888888885555550040004044004004004004444400050004400020000040400000000004444400004002222000040444440400004000000004000040400555555555555555555588888888888888
8888888888555555550040000004004000004000000100555004400222220040000040002004000400000002222220040000040400000040000000000040000555555555555555555588888888888888
8888888885555555550000000004000000000000000100555004400222220040000144002000000400200022222220000000000400000444400500050000005555555555555555555888888888888888
8888888855555555555000555004004005500055500000555004400222220000000014002200000000022222222220040022000000200444000555555000555555555555555555555888888888888888
8888888855555555555555555004000005555555550005555004400222222000220001002222000000002222222220000022220002200040005555555555555555555555555555558888888888818888
8888888855555555555555555004000055555555555555555000000222222222222001002200005555000022222222000222222222220040055555555555555555555555555555558888888888111888
8888888855555555555555555000005555555555555555550004400222222222222001002000055555500002222222222222222222220000055555555555555555555555555555588888888888818888
8888888885555555555555555500055555555555555555550000000222222222222000000005555555555000022222222222222222222000555555555555555555555555555555888888888888888888
8888888888555555555555555555555555555555555555550000002222222222222200000055555555555500000222222222222222222200555555555555555555555555555558888888888888888888
8888888888888555555555555555555555555555555555550022222222222222222200005555555555555555000022222222222222222200855555555555555555555555555588888888888888888888
8888888888888555555555555555555555555555555555500022222222222222220000555555555555555555550000222222222222222200085555555555555555555555555888888888888888888888
8888888888888855555555555555555555555555555555500222222222222222200005555555555555555555555000022222222222222220088555555555555555555555558888888888888888888888
8888888888888855555555555555555555555555555555500222222222222220000555555555555555555555555550000222222222222220088885555555555555555555888888888888888888888888
8888888888888885555555555555555555555555555555500222222222222200008855555555555555555585555555000022222222222220088885555555555555555558888888885558888888888888
8888888888888888555555555555555555555555555555500222222222220000888885555555555555555888555555550000222222222200088855555555555555555558888888855555888888888888
8888888588888888555555555555555555555555555555500222222222200008888888555555555555558888855555588000022222220000888855555555555555555558888888855555888888888888
8888885558888888855555555555555555555555555555500022222220000888888888885555555555588888885555888880000222200008888855555555555555555558888888855555888888888888
8888888588888888885555555555555555555555555555550002222000008888888888888855555555588888888888888888000000000888888855555555555555555588888888885558888888888888
8888888888888888888555555555555555555555555555555000000000888888888888888885555555588888888888888888880000008888888855555555555555555588888888888888888888888888
8888888888888888888885555555555555555555555555555500000088888888888888888885555555588888888888888888888888888888888885555555555555555888888888888888888888888888
8888888888888888888888555555555555555555555555555558888888888888888888888888555555888888888888888888888888888888888885555555555555558888888888888888888888888888
5888588858885888588858885555555555555585555555555588588858885888588858885888555558885888588858885888588858885888588858555555555555585888588858885888588858885888
8888888888888888888888888885555555588888555555555888888888888888888888888888888888888888888888888888888888888888888888855555555558888888888888888888888888888888
8858885888588858885888588858885888588858855555558855885888588858885888588858885888588858885888588858885888588858885888585555555888588858885888588858885888588858
8888888888888888888888888888888888888888885555588555588888888888888888888858888888888888888888888888888888888888888888888888888888888888888888888888888888888888
5858585858585858585858585858585858585858585858585555585858585858585858585555585858585858585858585858585858585858585858585858585858585858585858585858585858585858
8888888888888888888888888888888888888888888888888855888888888888888888888858888888888888888888888888888888888888888888888888888888888888888888888888888888888888
5858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858
8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
5858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858
8588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588
5858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858
8885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885888588858885
5858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858
8585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585
5858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858
8585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585
5558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558
8585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585
5855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855
8585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585858585
5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585
5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
8555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555855585558555`
const titleChunks = splitBitmap(doubleBitmap(titleImage))
const titleChars = "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz".split("")
let titleLegend = titleChunks.map((chunk, index) => [titleChars[index], chunk]);

setLegend(...titleLegend)
setMap(map`
..........
.AaBbCcDd.
.EeFfGgHh.
.IiJjKkLl.
.MmNnOoPp.
.QqRrSsTt.
.UuVvWwXx.
..........`)


const textColors = [color`3`, color`7`]
let currentTextColor = 1;
addText("Press any button", {x: 2, y: 13, color: textColors[0]})
const blinkingTextInterval = setInterval(() => {
  currentTextColor = 1 - currentTextColor;
  
  clearText();
  addText("Press any button", {x: 2, y: 13, color: textColors[currentTextColor]})
}, 1000)


let gameStarted = false;
"wasdijkl".split("").forEach(key => {
  onInput(key, () => {
    if (!gameStarted) startGame()
  })
})


const playerRedUp = "1"
const playerRedDown = "2"
const playerRedLeft = "3"
const playerRedRight = "4"
const playerBlueUp = "5"
const playerBlueDown = "6"
const playerBlueLeft = "7"
const playerBlueRight = "8"
const paintRed = "Y"
const paintRedSpecial1 = "z"
const paintRedSpecial2 = "9"
const paintRedSpecial3 = "0"
const paintBlue = "y"
const paintBlueSpecial1 = "`"
const paintBlueSpecial2 = "~"
const paintBlueSpecial3 = "-"
const background = "Z"


let canvas;

function startGame() {
  clearInterval(blinkingTextInterval)
  clearText()
  setTimeout(() => gameStarted = true, 10)

  setLegend(
  [playerRedUp, bitmap`
................
..000000000000..
..066663666360..
..063333333330..
..06333333333000
..033333333330.0
..000000000000.0
...............0
.......000000000
.......0........
......0000......
......0660......
......0630......
......0330......
......0330.....C
......0000......` ],
  [playerRedDown, bitmap`
......0000......
......0660......
......0630......
......0330......
......0330......
......0000......
.......0........
.......000000000
...............0
..000000000000.0
..066663666360.0
..06333333333000
..063333333330..
..033333333330..
..000000000000..
................` ],
  [playerRedLeft, bitmap`
................
................
.000000.........
.066630.........
.063330.........
.063330.........
.063330...000000
.033330.00066630
.063330.0.063330
.063330.0.000000
.033330.0.......
.033330.0.......
.033330.0.......
.000000.0.......
....0...0.......
....00000.......` ],
  [playerRedRight, bitmap`
.......00000....
.......0...0....
.......0.000000.
.......0.066630.
.......0.063330.
.......0.063330.
000000.0.063330.
066630.0.033330.
06333000.063330.
000000...063330.
.........033330.
.........033330.
.........033330.
.........000000.
................
................` ],
  [playerBlueUp, bitmap`
................
..000000000000..
..077775777570..
..075555555550..
..07555555555000
..055555555550.0
..000000000000.0
...............0
.......000000000
.......0........
......0000......
......0770......
......0750......
......0550......
......0550......
......0000......` ],
  [playerBlueDown, bitmap`
......0000......
......0770......
......0750......
......0550......
......0550......
......0000......
.......0........
.......000000000
...............0
..000000000000.0
..077775777570.0
..07555555555000
..075555555550..
..055555555550..
..000000000000..
................` ],
  [playerBlueLeft, bitmap`
................
................
.000000.........
.077750.........
.075550.........
.075550.........
.075550...000000
.055550.00077750
.075550.0.075550
.075550.0.000000
.055550.0.......
.055550.0.......
.055550.0.......
.000000.0.......
....0...0.......
....00000.......` ],
  [playerBlueRight, bitmap`
.......00000....
.......0...0....
.......0.000000.
.......0.077750.
.......0.075550.
.......0.075550.
000000.0.075550.
077750.0.055550.
07555000.075550.
000000...075550.
.........055550.
.........055550.
.........055550.
.........000000.
................
................` ],
  [background, bitmap`
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2222222212121212
2222222221212121
2222222212121212
2222222221212121
2222222212121212
2222222221212121
2222222212121212
2222222221212121` ],
  [paintRed, bitmap`
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333` ],
  [paintRedSpecial1, bitmap`
3333333333333333
3399933333333333
3999933333333333
3999333333333333
3393333333333333
3333333333333333
3333333333333333
3333333333333993
3333333333339993
3333333333999993
3333333999999993
3333339999999993
3333333999999933
3333333399999333
3333333333333333
3333333333333333` ],
  [paintRedSpecial2, bitmap`
3333333333333333
3333333333333333
3333333399999333
3333333399999933
3333333999999933
3333399999999933
3333339999993333
3333333333333333
3333333333333333
3333333333333333
3333333333993333
3333333333999333
3993333333399333
3933333333333333
3333333333333333
3333333333333333` ],
  [paintRedSpecial3, bitmap`
3333333333333333
3333333333333333
3339999333333333
3339999993333333
3399999999333333
3999933333333333
3999333399993333
3999333999999333
3993333999999933
3333333333999933
3333333333399933
3333333333999933
3333333333999333
3333333339999333
3333333399333333
3333333333333333` ],
  [paintBlue, bitmap`
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial1, bitmap`
5555555555555555
5555555555555555
5555577757777555
5557777777775555
5557777777775555
5557777777555555
5557757775555555
5557555555555577
5555555555555777
5555555555555775
5555555555555555
5555555577555555
5555777777755555
5557777777555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial2, bitmap`
5555555555555555
5557557555555555
5557777775555555
5777777777555555
5577777777555555
5577777777555555
5557777555555555
5555575555555555
5555555555555775
5555555555555775
5555555555555555
5577555555555555
5577555555555555
5575555555555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial3, bitmap`
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555775755555
5555555777777755
5555555577777775
5555555557777775
5555555777777775
5555555577777555
5555555577755555
5577555555555555
5777555555555555
5777555555555555
5575555555555555
5555555555555555` ],
  ...titleLegend
)
  
  
  setBackground(background)
  setMap(map`
.........6
..........
..........
..........
..........
..........
..........
1.........`)
  
  // Create an array the size of the game board, to keep track of paint
  canvas = []
  for (let i = 0; i < 10; i++) {
	canvas.push(Array(8).fill(""))
  }


  // the canvas should start off painted where the players spawn
  canvas[9][0] = paintBlue
  canvas[0][7] = paintRed
  addSprite(9, 0, paintBlue)
  addSprite(0, 7, paintRed)
}

const spritesRed = ["1", "2", "3", "4"]
const controlsRed = {
  "w": {
    func: p => p.y -= 1,
    type: "1",
  },
  "s": {
    func: p => p.y += 1,
    type: "2",
  },
  "a": {
    func: p => p.x -= 1,
    type: "3",
  },
  "d": {
    func: p => p.x += 1,
    type: "4",
  },
}

const spritesBlue = ["5", "6", "7", "8"]
const controlsBlue = {
  "i": {
    func: p => p.y -= 1,
    type: "5",
  },
  "k": {
    func: p => p.y += 1,
    type: "6",
  },
  "j": {
    func: p => p.x -= 1,
    type: "7",
  },
  "l": {
    func: p => p.x += 1,
    type: "8",
  },
}

setSolids([...spritesRed, ...spritesBlue]);

[
  [spritesBlue, controlsBlue, paintBlue, [paintBlueSpecial1,paintBlueSpecial2,paintBlueSpecial3]],
  [spritesRed, controlsRed, paintRed, [paintRedSpecial1,paintRedSpecial2,paintRedSpecial3]]
].forEach(data => {
  const [sprites, controls, paintColor, specialPaint] = data;

  Object.keys(controls).forEach(key => {
    onInput(key, () => {
      if (!gameStarted) return
      
      let player;
      // find the player, regardless of what directional sprite is in use right now
      for (const sprite of sprites) {
        console.log(sprite)
        player = getFirst(sprite);
        if (player) break;
      }

      // move the player
      controls[key].func(player);
      player.type = controls[key].type;

      // color the canvas at that spot
      let currentColor = canvas[player.x][player.y]
      if (currentColor == "") {
        addSprite(player.x, player.y, paintColor)
      } else {
        for (let sprite of getTile(player.x, player.y)) {
          if (sprite.type == currentColor) {
            
            // random chance to pick a special paint sprite
            if (Math.random() < 0.35) {
              paintSprite = specialPaint[Math.floor(Math.random() * specialPaint.length)]
            } else {
              paintSprite = paintColor
            }
            
            sprite.type = paintSprite
          }
        }
      }
      canvas[player.x][player.y] = paintColor
    })
  })
})



