/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: Hue Domination
@author: Gus Ruben
@tags: [2-Player, Multiplayer, PVP]
@addedOn: 2024-00-00
*/

let currentLegendChar = 32; // start at the first real character (space)
function getLegendChar() {
  const char = String.fromCharCode(currentLegendChar++)
  if (char == "." || char == "\n" || char == " ") { // skip reserved characters
    return String.fromCharCode(currentLegendChar++)
  }
  return char;
}

// the title screen image needs to be split into 16x16 chunks
function splitBitmap(bitmap) {
    const rows = bitmap.trim().split('\n')
    const chunks = [];
    const chunkRows = rows.length / 16;
    const chunkCols = rows[0].length / 16;
  
    for (let i = 0; i < chunkRows; i++) {
        for (let j = 0; j < chunkCols; j++) {
            let chunk = [];
            for (let r = 0; r < 16; r++) {
                const rowIndex = i * 16 + r;
                const startCol = j * 16;
                const endCol = startCol + 16;
                
                chunk.push(rows[rowIndex].slice(startCol, endCol));
            }
            chunks.push(chunk.join('\n'));
        }
    }

    return chunks;
}

// dimensions need to be a multiple of 16
const titleImage = bitmap`
3333333333333333333333333333333333333333333333333333333333333333333333333333377777777777777777777777777777777777777777777777777777777777777777777777777777777777
3333333333333333333333333333333333333333333333333333333333333333333333333333337777777777777777777777777777777777777777777777777777777777777777777777777777777777
3333333333333333333333333333333333333333333333333333333333333333333333333333337777777777777777777777777777777777777777777777777777777777777777777777777777777777
3333333333333333333333333333333333333233333333333323333333332333333333333333322777777777777727777777777777777772777777777777777777777777777777777777777777777777
3333333333333333333333333333333333333323333333333222333333332322233333333333222277777777777227777777777777777272777777777777777777777777777777777777777777777777
3333333333333333333333333333333333333323333333322222233333332222233333333333222277777277777222777777777777772222277777777727777777777777777777777777777777777777
3333333333333333333333333333333333332222333333222222213333332222223333323333222272222277777222777777222777722222277777777727777777777777777777777777777777777777
3333333333333333333323333333332233332222333333222222111333332223223111122233222222222277772222777772222777722227272777777727777777777777777777777777777777777777
3333333333333333333322233333332233332222233333322222212233332222221111112222221111111117722222777112222777772277772277277727777772777777777777777777777777777777
3333333333333333333332223333332233332222233333322222222223322222211111111221111111111111112272271111222777772227272222277722772772777777777777777777777777777777
3333333333333323333330000003333233332222223333323322222223322222111111111111111111111111111122221111212277772111272222277722772222777777777777777777777777777777
3333333333333322333000000000033111111122222333323322222223322221111111111111111111111111111111222117111277721111122222277722772222277777777777777777777777777777
3333333333333322330000333300001111111111122233322222222223222221111111111111111111111111111111122227712277721111122222277222772222222000000007277777777777777777
3333333333333322200033322333000111111111111233322222222222222221111111111111111111111111111111112222222277221111122222277222772222200000000000727777777777777777
3333333333333322000333233333300111111111111133322222222222222221111111111111111111111111111111111222222277222111222222272222772222000077777700077777777777777777
3333333333333222003399333333300011111111111113322222222222222221111111111111111111111111111111111122222227222222222272222222772222007777222770007777777777777777
3333333333333222003000933333330011111111111111322111112222222222111111111111111111111111111111111112222227222222222777222211111122000007777277000777777777777777
3333333333333222000000933333330001111111111111111111111122222222211111111111111111111111111111111111222227222222222272221111111112200000777777700777777777777777
3333333233333222200000093333333001111111111111111111111112222222211111111111111111111111111111111111222222222221111112211111111111222000077777700077777777777777
33333332333332222222200933333330001111111111111111111111112222221111111111111111111111111111111110000222272221111111111111111100000000007777777H0077777777777777
33333332233332332222100933333333001111111111111111111111112222200011111111111111111111111111111100000022222211111111111111110000000000777777777H0077777777777777
33333332233332333222100993333333001111111111111111111111111222000001111111111111111111111111110000330002222111111111111111100007777777777777777H0077777777777777
3333333223333223222200099333333300011111111111111111111111122000300011111111111111111111111110000333300222111111111111111100077777777777777777HH0077777777777777
3333333211333111222100999333333330000111111111111111111111122003330011111111111111111111111100030033300221111111111111111000777777777777777777HH0077777777777777
3333333111131111122100999333333333000011111111111111111111122003300011111111111111111111111100333003000221111111111111110007777777777777777777H00077777777777777
233333311113111112210099933333333333000111111111111111111111100330000011111111111111111111110003000300111111111111111111007777777777777777777HH00777727777777777
23333332113311111221009993333333333330011111111111111111111110009000000111100000110000000011100300030011111111111111111100F777777777777777777HH00777727777777777
23333332233331112221009993333333333330001111110001111100000001000000900010000000000000000000000000000000011111111111111000FF77777777777777777HH00777727777777777
23333332233332222221009993333333333FFF00000110000011100000000010000999000000999000099990900000000000000000011111111110000FF77777777777777777HH000777727777777777
233333322333322222210099993333333333FF00000000030001000999990000099999900099999990999999990999999000999900001111111100001FFF77F777777777777HHH002777727777777777
23333332223322222222009999333333333FF11111000033300000992999900099999993099229299099999930092229299999999900011111100011111FF7FF7777777777HHHH002777727777777777
23333333223321111122000999933333FFFF111111100033000009929999000099993330992999933099999333092999999999999990011110000CC11111FFFF77777777HHHHH0002777727777777777
3333333322231111111210099999933FFFF11111CCCC003000000929999900099993339092999333300999333309929999999333333000100000CCCCCC111FFF7777777HHHHH00022777777777777777
333333332221111111112000999999FFFF1111CCCCCC0030000099299933000999333309929933333009933333909299993333333333000000CCCCCCCCC111FFF777HHHHHHH000222777777777777777
3333333322111111111111000999F99FF1111CCCCCCC00300099999933300099993339092999333090099333333092999333333333330000CCCCCCCCCCCC111FFFFHHHHHH00007222777777777777772
3333333321111111111111100099FFFF1111CCCCCCCC0000099999933330009993339909999333309009933333309999333333030030000CCCCCCCCCCCCCC111FF7FHHHH000077222777777777777722
3333333311111111111111110000FFF1111CCCCCCCCCC000009999333333009933339099993333300009933333300999333300000090000CCCCCCCCCCCCCCC111FFFF000001277222777777777777722
333333331111111111111111100000F111CCCCCCCCCCCCC00099993333333333333330999333333000093333333009993333000000000000CCCCCCCCCCCCCC111F000000011177222777727777777722
333333331111111111111111111000111CCCCCCCCCCCCCC0099993333333333333333099333333300000333333300993333330009999990000CCCCCCCCCCCCC111000011111177222277227777777722
333333331111111111111111111100111CCCCCCCCCCCCCC00999333333333333333330933333333030033333333009933333333339993990000CCCCCCCCCCCCC11001111111172222272227177777722
33333333111111111111111111110001CCCCCCCCCCCCCC0009993333333333333333309333333333330333333333093333333333333333303000CCCCCCCCCCCC10001111111122222272221117777722
33333233111111111111111111111000CCCCCCCCCCCCCC0099933333333333333333003333333333300333333333093333333333333333333300CCCCCCCCCCCC00011111111122222272227177777722
333332322111111111111111111111000CCCCCCCCCCCCC0099333333333333333333003333333333300333333333033333333333333333333000000CCCCCCCC000111111111122222222227777277722
333322222211111111111111111111100CCCCCC0000CCC00933333333333333333330033333333333333333333330333333333333333333300000000CCCCCCC001111111111222222222227777227722
3333222322211111111111111111111000CCCC000000C0003333333333333333333300033333333333333333333303333333333333333303000033000CCCCC0001111111111222221272227777227722
33332233322111111111111111111111000CC000330000033333333330333333333300033333333333333333333303333333333300300000000333300CCCC00011111111111222211122227777227722
33332223222111111111111111111111100C0003333000033333333300033333333300033333333333333333333003333333333000000000000033000CCCC00111111111111122221222227777227722
333322222221111111111111100000111000003333300003333333330003333333333003333333333333333333300333333333300003999990003000CCCC000111111111111112222222227777222722
33332222222111111111111100000001110000033300030333333333000333333333300333333333333333333330333333333330333333399000000CCCC0001111111111111111111222227777722222
23322222211111111111111100777000111000030000333333333333003333333333300033333333333333333330333333333333333333333300300C0000011111111111111111111122227777772222
2332222211111111111111110007770011110003000003333333333300333333333330003333333333333333333033333333333333333333330000000000001111111111111111111112227777772722
2332222111111111111111111000770011111003000000333333333300333333333330003333333333333333330033333333333333333333330000000770000111111111111111111111227777772222
2332222111111111111111111100700011111003000000333333333000333333333330003033333333333333030033333333333333333333300000007777700111111111111111111111227777772222
2332222111111111111111111100000111111000000000303333333000333333333330003033333333333333000333333333333333330333300000000777000111111111111111111111227777772222
2322222111111111111111111100700111111100000000300300030000330330003330000033033333333303003333003330300330330030300000000070000000011111111111111111227777772222
2322222211111111111111000000000111100000070000300300030000300030030000000033000033333000000330000000000300030000300000000070000000000111111111111112222777772222
2222222221111111111110000000000010000000777000300000000000000030000000000033000000000000000030000007700000030000300000000000007777000011111111111122222777772222
2222222222222111111100077777770000007777777000300000077777000000077777700033000000077777770000007777777770000000300000007007777777770001111111111122222777772222
2322222222222211111000772227277000077222777700300000772277777000772272700000000000772227770000077222727777777000000000077777227777777000111111111122222777772222
2222222222222211110007727777777000772777777700000007727777777007727777770033000000727777770000072777777777777700300000007722777777777700011111111222222777772222
2222222222222221110077277777770007727777777700300077277777777770727777770000000000727777770000772777777777777700000000077277777777777770001112222227222277772222
2222222222222221100072777777770007777777777000000072777777777000727777777000000077777777770000727777777777777770000000777777777777777777001122222277722227722222
2222222222222221100772777777770007777777777700000772777777777700777777777000000777777777770007727777777777777777000000777777777777777777000122222227222227722222
2222222222222221000777777777700077777777777700000777777777777700777777777000000077777777770077777777777777777777000007777777777777777777700112222222222227722222
2222222222222210007777777777700077777777777700000777777077777700707777777700000007777777770777777777777777777777700007777777770770777777000111222222112227722222
2222222222222210077777777777777777777777777700007777770070777770707777777770000077777777070777777777777777777777700077777777070070077777001111122221111227722222
2222222222222210007777777777777777777777777700007777770000777770007777777770000077777777000777777777700707777777770077777777070000007777001111112221111227722222
2222122222220000000777777777777777777777770700007777777007777770007777777770000777777777007777777770700000777777770077777770070000000707001111112222112222722222
2221112222200000000777777777777777777777770000077777777777777777000777777777000777777777007777777770700000777777770777777770070000000007001000011222222222722222
2222122222000770000777777777777777777777770000077777777777777777000777777777007777777770007777777770700007777777770777777770000000000007000000001222222222722222
2222222222007770000777777777777777777777770000777777777777777777000077777777777777777770007777777770007707777777770777777770000000000000000077000122222222222222
22222222220077700007777777777777777777777700077777777777777777770000777777777777777777H0077777777770077777777777700777777770000000077000000777700122222222222222
2222222222007700000777777777777777777777777000777777777777777777H00077777777777777777HH0077777777777007777777777700777777777000007777700000777700122222222222722
222223222200070010077777777770077777777777700007777777777777777HH00077777777777777777HH0077777777777777777777777700777777777777777777HH0000007700112222272222222
222233322220070010007777777770007777777777700007777777777777777HH000777777777777777770H00777777777777777777777777007777777777777777HHHH0000000700112222272222222
222223222220000011007777777770007777777777700007777777777777777HH0007077777777777777H0H0077777777777777777777HH0H0077777777777777HHHHHHH000100700112222272222222
2222222222220002110077777777HH0007777777777H000777777HH77777777HHH00707777777777777HH0H007777777777777777777HHH0000777777777777HHHHHHHHHH00100700112222272222122
2222222222222221110077777777HH0007777777777H00077777HHHH7777777HHH0000077777777777HHH0H0077777777777777777HHHHH0H000777777777HHHHHHHH00H000100000112222222221112
222222222222221111007777777HHH000777777777HHH000777HHHH00777777HHH00H00777777777HHHHH0H007777777777777777HHHHHH00000H7777777HHHHHHHH0000001100700112222222222122
22222222222222111100707777HHHHH00777777777HHH000777HHH0000777HHHHH0000077777777HHHH0H00007077777777777HHHHHHH0H0000007777HHHHHHHHHHH0000011100000112222222222222
222222222222211111007007HHHHHHH0070777777HHHH00007HHHH000077HHHHHHH0000777777HHHHH00H0H00H00H7777HHHHHHHHHHHH0H0000007HHHHHHHHHHH00H0011111110001112222222222222
22222222222221111100H00HHHHHHHHH0H00HHHHHHHHHH000HHHHH000070HHHHHHH0000707HHHHHHH000H0000000HHHHHHHHHHHHHHH0H00000000HHHHHHHHH0000000011111111111112222222222222
22222222222221111100H000HHHHHHH00H00HHHHHHHHH00000HHH00000000HHHHH00000000HHHHHHH000H000000000HHHHHHHHHHH000H00000000H000HH0H00000000111111111111122222222222222
22222222222211111100H000H0HH00H00H00H00HHHHH0001000HH000C00000H0H0000000000HHHHH0000H00CCCC0000H0HHHHH0H0000H00000000H0000H0H00111111111111111111122222222222222
22222222221111111100H000000H00H00000H00000070011100HH00CCCCC00H00000H000C00H000H0000000CCCCCC00H00000H0H000000H00000000000H0000111111111111111111122222222222222
222222222111111111000000000H00000000000000070011100HH00CCCCC00H00007HH00C000000H00C000CCCCCCC0000000000H00000HHHH00100010000001111111111111111111222222222222222
222222221111111111100011100H00H00110001110000011100HH00CCCCC000000007H00CC000000000CCCCCCCCCC00H00CC000000C00HHH000111111000111111111111111111111222222222222222
222222221111111111111111100H00000111111111000111100HH00CCCCCC000CC000700CCCC00000000CCCCCCCCC00000CCCC000CC000H0001111111111111111111111111111112222222222272222
222222221111111111111111100H000011111111111111111000000CCCCCCCCCCCC00700CC000011110000CCCCCCCC000CCCCCCCCCCC00H0011111111111111111111111111111112222222222777222
222222221111111111111111100000111111111111111111000HH00CCCCCCCCCCCC00700C00001111110000CCCCCCCCCCCCCCCCCCCCC0000011111111111111111111111111111122222222222272222
2222222221111111111111111100011111111111111111110000000CCCCCCCCCCCC0000000011111111110000CCCCCCCCCCCCCCCCCCCC000111111111111111111111111111111222222222222222222
222222222211111111111111111111111111111111111111000000CCCCCCCCCCCCCC00000011111111111100000CCCCCCCCCCCCCCCCCCC00111111111111111111111111111112222222222222222222
22222222222221111111111111111111111111111111111100CCCCCCCCCCCCCCCCCC000011111111111111110000CCCCCCCCCCCCCCCCCC00211111111111111111111111111122222222222222222222
22222222222221111111111111111111111111111111111000CCCCCCCCCCCCCCCC0000111111111111111111110000CCCCCCCCCCCCCCCC00021111111111111111111111111222222222222222222222
2222222222222211111111111111111111111111111111100CCCCCCCCCCCCCCCC000011111111111111111111110000CCCCCCCCCCCCCCCC0022111111111111111111111112222222222222222222222
2222222222222211111111111111111111111111111111100CCCCCCCCCCCCCC0000111111111111111111111111110000CCCCCCCCCCCCCC0022221111111111111111111222222222222222222222222
2222222222222221111111111111111111111111111111100CCCCCCCCCCCCC000022111111111111111111211111110000CCCCCCCCCCCCC0022221111111111111111112222222221112222222222222
2222222222222222111111111111111111111111111111100CCCCCCCCCCC0000222221111111111111111222111111110000CCCCCCCCCC00022211111111111111111112222222211111222222222222
2222222122222222111111111111111111111111111111100CCCCCCCCCC000022222221111111111111122222111111220000CCCCCCC0000222211111111111111111112222222211111222222222222
22222211122222222111111111111111111111111111111000CCCCCCC0000222222222221111111111122222221111222220000CCCC00002222211111111111111111112222222211111222222222222
222222212222222222111111111111111111111111111111000CCCC000002222222222222211111111122222222222222222000000000222222211111111111111111122222222221112222222222222
2222222222222222222111111111111111111111111111111000000000222222222222222221111111122222222222222222220000002222222211111111111111111122222222222222222222222222
2222222222222222222221111111111111111111111111111100000022222222222222222221111111122222222222222222222222222222222221111111111111111222222222222222222222222222
2222222222222222222222111111111111111111111111111112222222222222222222222222111111222222222222222222222222222222222221111111111111112222222222222222222222222222
1222122212221222122212221111111111111121111111111122122212221222122212221222111112221222122212221222122212221222122212111111111111121222122212221222122212221222
2222222222222222222222222221111111122222111111111222222222222222222222222222222222222222222222222222222222222222222222211111111112222222222222222222222222222222
2212221222122212221222122212221222122212211111112211221222122212221222122212221222122212221222122212221222122212221222121111111222122212221222122212221222122212
2222222222222222222222222222222222222222221111122111122222222222222222222212222222222222222222222222222222222222222222222222222222222222222222222222222222222222
1212121212121212121212121212121212121212121212121111121212121212121212121111121212121212121212121212121212121212121212121212121212121212121212121212121212121212
2222222222222222222222222222222222222222222222222211222222222222222222222212222222222222222222222222222222222222222222222222222222222222222222222222222222222222
1212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212
2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
1212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212
2122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122
1212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212
2221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221222122212221
1212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212
2121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212
2121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112
2121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211
2121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
2111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111`
const titleChunks = splitBitmap(titleImage)
console.log(titleImage, titleChunks)
let titleLegend = titleChunks.map((chunk, index) => [getLegendChar(), chunk]);

setLegend(...titleLegend)
// create the map by joining every char for the title into one string, then inserting newlines
const titleMap = titleLegend.map(v => v[0]).join("").replace(/(.{10})/g, "$1\n").slice(0,-1);
console.log([titleLegend, titleMap])
setMap("\n" + titleMap)


const textColors = [color`3`, color`7`]
let currentTextColor = 1;
addText("Press any button", {x: 2, y: 13, color: textColors[0]})
const blinkingTextInterval = setInterval(() => {
  currentTextColor = 1 - currentTextColor;
  
  clearText();
  addText("Press any button", {x: 2, y: 13, color: textColors[currentTextColor]})
}, 1000)


let gameStarted = false;
"wasdijkl".split("").forEach(key => {
  onInput(key, () => {
    if (!gameStarted) startGame()
  })
})


const playerRedUp = "1"
const playerRedDown = "2"
const playerRedLeft = "3"
const playerRedRight = "4"
const playerBlueUp = "5"
const playerBlueDown = "6"
const playerBlueLeft = "7"
const playerBlueRight = "8"
const paintRed = "Y"
const paintRedSpecial1 = "z"
const paintRedSpecial2 = "9"
const paintRedSpecial3 = "0"
const paintBlue = "y"
const paintBlueSpecial1 = "`"
const paintBlueSpecial2 = "~"
const paintBlueSpecial3 = "-"
const background = "Z"


let canvas;

function startGame() {
  clearInterval(blinkingTextInterval)
  clearText()
  setTimeout(() => gameStarted = true, 10)

  setLegend(
  [playerRedUp, bitmap`
................
..000000000000..
..066663666360..
..063333333330..
..06333333333000
..033333333330.0
..000000000000.0
...............0
.......000000000
.......0........
......0000......
......0660......
......0630......
......0330......
......0330.....C
......0000......` ],
  [playerRedDown, bitmap`
......0000......
......0660......
......0630......
......0330......
......0330......
......0000......
.......0........
.......000000000
...............0
..000000000000.0
..066663666360.0
..06333333333000
..063333333330..
..033333333330..
..000000000000..
................` ],
  [playerRedLeft, bitmap`
................
................
.000000.........
.066630.........
.063330.........
.063330.........
.063330...000000
.033330.00066630
.063330.0.063330
.063330.0.000000
.033330.0.......
.033330.0.......
.033330.0.......
.000000.0.......
....0...0.......
....00000.......` ],
  [playerRedRight, bitmap`
.......00000....
.......0...0....
.......0.000000.
.......0.066630.
.......0.063330.
.......0.063330.
000000.0.063330.
066630.0.033330.
06333000.063330.
000000...063330.
.........033330.
.........033330.
.........033330.
.........000000.
................
................` ],
  [playerBlueUp, bitmap`
................
..000000000000..
..077775777570..
..075555555550..
..07555555555000
..055555555550.0
..000000000000.0
...............0
.......000000000
.......0........
......0000......
......0770......
......0750......
......0550......
......0550......
......0000......` ],
  [playerBlueDown, bitmap`
......0000......
......0770......
......0750......
......0550......
......0550......
......0000......
.......0........
.......000000000
...............0
..000000000000.0
..077775777570.0
..07555555555000
..075555555550..
..055555555550..
..000000000000..
................` ],
  [playerBlueLeft, bitmap`
................
................
.000000.........
.077750.........
.075550.........
.075550.........
.075550...000000
.055550.00077750
.075550.0.075550
.075550.0.000000
.055550.0.......
.055550.0.......
.055550.0.......
.000000.0.......
....0...0.......
....00000.......` ],
  [playerBlueRight, bitmap`
.......00000....
.......0...0....
.......0.000000.
.......0.077750.
.......0.075550.
.......0.075550.
000000.0.075550.
077750.0.055550.
07555000.075550.
000000...075550.
.........055550.
.........055550.
.........055550.
.........000000.
................
................` ],
  [background, bitmap`
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2121212122222222
1212121222222222
2222222212121212
2222222221212121
2222222212121212
2222222221212121
2222222212121212
2222222221212121
2222222212121212
2222222221212121` ],
  [paintRed, bitmap`
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333` ],
  [paintRedSpecial1, bitmap`
3333333333333333
3399933333333333
3999933333333333
3999333333333333
3393333333333333
3333333333333333
3333333333333333
3333333333333993
3333333333339993
3333333333999993
3333333999999993
3333339999999993
3333333999999933
3333333399999333
3333333333333333
3333333333333333` ],
  [paintRedSpecial2, bitmap`
3333333333333333
3333333333333333
3333333399999333
3333333399999933
3333333999999933
3333399999999933
3333339999993333
3333333333333333
3333333333333333
3333333333333333
3333333333993333
3333333333999333
3993333333399333
3933333333333333
3333333333333333
3333333333333333` ],
  [paintRedSpecial3, bitmap`
3333333333333333
3333333333333333
3339999333333333
3339999993333333
3399999999333333
3999933333333333
3999333399993333
3999333999999333
3993333999999933
3333333333999933
3333333333399933
3333333333999933
3333333333999333
3333333339999333
3333333399333333
3333333333333333` ],
  [paintBlue, bitmap`
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial1, bitmap`
5555555555555555
5555555555555555
5555577757777555
5557777777775555
5557777777775555
5557777777555555
5557757775555555
5557555555555577
5555555555555777
5555555555555775
5555555555555555
5555555577555555
5555777777755555
5557777777555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial2, bitmap`
5555555555555555
5557557555555555
5557777775555555
5777777777555555
5577777777555555
5577777777555555
5557777555555555
5555575555555555
5555555555555775
5555555555555775
5555555555555555
5577555555555555
5577555555555555
5575555555555555
5555555555555555
5555555555555555` ],
  [paintBlueSpecial3, bitmap`
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555775755555
5555555777777755
5555555577777775
5555555557777775
5555555777777775
5555555577777555
5555555577755555
5577555555555555
5777555555555555
5777555555555555
5575555555555555
5555555555555555` ],
  ...titleLegend
)
  
  
  setBackground(background)
  setMap(map`
.........6
..........
..........
..........
..........
..........
..........
1.........`)
  
  // Create an array the size of the game board, to keep track of paint
  canvas = []
  for (let i = 0; i < 10; i++) {
	canvas.push(Array(8).fill(""))
  }


  // the canvas should start off painted where the players spawn
  canvas[9][0] = paintBlue
  canvas[0][7] = paintRed
  addSprite(9, 0, paintBlue)
  addSprite(0, 7, paintRed)
}

const spritesRed = ["1", "2", "3", "4"]
const controlsRed = {
  "w": {
    func: p => p.y -= 1,
    type: "1",
  },
  "s": {
    func: p => p.y += 1,
    type: "2",
  },
  "a": {
    func: p => p.x -= 1,
    type: "3",
  },
  "d": {
    func: p => p.x += 1,
    type: "4",
  },
}

const spritesBlue = ["5", "6", "7", "8"]
const controlsBlue = {
  "i": {
    func: p => p.y -= 1,
    type: "5",
  },
  "k": {
    func: p => p.y += 1,
    type: "6",
  },
  "j": {
    func: p => p.x -= 1,
    type: "7",
  },
  "l": {
    func: p => p.x += 1,
    type: "8",
  },
}

setSolids([...spritesRed, ...spritesBlue]);

[
  [spritesBlue, controlsBlue, paintBlue, [paintBlueSpecial1,paintBlueSpecial2,paintBlueSpecial3]],
  [spritesRed, controlsRed, paintRed, [paintRedSpecial1,paintRedSpecial2,paintRedSpecial3]]
].forEach(data => {
  const [sprites, controls, paintColor, specialPaint] = data;

  Object.keys(controls).forEach(key => {
    onInput(key, () => {
      if (!gameStarted) return
      
      let player;
      // find the player, regardless of what directional sprite is in use right now
      for (const sprite of sprites) {
        console.log(sprite)
        player = getFirst(sprite);
        if (player) break;
      }

      // move the player
      controls[key].func(player);
      player.type = controls[key].type;

      // color the canvas at that spot
      let currentColor = canvas[player.x][player.y]
      if (currentColor == "") {
        addSprite(player.x, player.y, paintColor)
      } else {
        for (let sprite of getTile(player.x, player.y)) {
          if (sprite.type == currentColor) {
            
            // random chance to pick a special paint sprite
            if (Math.random() < 0.35) {
              paintSprite = specialPaint[Math.floor(Math.random() * specialPaint.length)]
            } else {
              paintSprite = paintColor
            }
            
            sprite.type = paintSprite
          }
        }
      }
      canvas[player.x][player.y] = paintColor
    })
  })
})



