/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: 
@author: 
@tags: []
@img: ""
@addedOn: 2024-00-00
*/

const player = "p"
const apple = "a"
const banana = "b"
const orange = "o"
const goal = "g";
const wall = "w";

setLegend(
  [ player, bitmap`
................
................
.......000......
.......010......
......0110......
......01110.....
...0..08180..0..
...00001110000..
......05550.....
......01110.....
.....011110.....
.....01110......
......000.......
......0.0.......
.....00.00......
................` ],
  [ apple, bitmap`
................
..........C.....
.........C......
.........C......
........C.......
......333333....
.....33333333...
.....33333333...
.....33333333...
.....33333333...
.....33333333...
.....33333333...
......333333....
................
................
................` ],
  [ banana, bitmap`
................
................
................
..C.............
..66............
..666...........
..6666..........
...6666.........
...666666.......
....666666......
.....666666.....
......666666....
.......666666...
.........6666C..
................
................` ],
  [ orange, bitmap`
................
................
................
................
................
......99CC9.....
.....9999999....
....999999999...
....999999999...
....999999999...
....999999999...
....999999999...
.....9999999....
......99999.....
................
................` ],
  [ goal, bitmap`
................
..4.4.4..4..444.
..4.4.4..4..4.4.
..44444..4..4.4.
................
................
.4.4.4..4..444..
.4.4.4..4..4.4..
.44444..4..4.4..
................
................
..4.4.4..4..444.
..4.4.4..4..4.4.
..44444..4..4.4.
................
................`],
  [ wall, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`]
);

setSolids([])

let level = 0
const levels = [
  map`
p..
.ag
...`,
  map`
p.g
.b.
...`,
  map`
p..g
.o..
....
..bg`,
  map`
p...
.ob.
....
gg..`,
  map`
.p..g
b....
..go.
....a
g....`,
  map`
p..g..
...b.g
...b..
..o...
g.aga.
....g.`
]

const currentLevel = levels[level];
setMap(currentLevel);

setSolids([ player, apple, banana, orange, wall ]); // other sprites cannot go inside of these sprites

setPushables({
  [ player ]: [apple, banana, orange,]
})

onInput("w", () => {
  getFirst(player).y -= 1
})
onInput("s", () => {
  getFirst(player).y += 1
})
onInput("a", () => {
  getFirst(player).x -= 1
})
onInput("d", () => {
  getFirst(player).x += 1
})

afterInput(() => {
  // count the number of tiles with goals
  const targetNumber = tilesWith(goal).length;
  
  // count the number of tiles with goals and boxes
  const numberCovered = tilesWith(goal, apple).length + tilesWith(goal, banana).length + tilesWith(goal, orange).length;

  // if the number of goals is the same as the number of goals covered
  // all goals are covered and we can go to the next level
  if (numberCovered === targetNumber) {
    // increase the current level number
    level = level + 1;

    const currentLevel = levels[level];

    // make sure the level exists and if so set the map
    // otherwise, we have finished the last level, there is no level
    // after the last level
    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
      addText("You Win!", { y: 4, color: color`3` });
    }
  }
});