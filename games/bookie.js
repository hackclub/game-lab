/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: 
@author: 
@tags: []
@img: ""
@addedOn: 2024-00-00
*/

const player = "p"
const fruit="f"
const basket = "b"
const fence = "r"
const grass= "g"
const melody = tune`
153.0612244897959: G5^153.0612244897959,
153.0612244897959: C4/153.0612244897959 + G5^153.0612244897959 + A4~153.0612244897959,
153.0612244897959: D4/153.0612244897959 + A5~153.0612244897959 + G5~153.0612244897959 + A4~153.0612244897959,
153.0612244897959: E4/153.0612244897959 + G5~153.0612244897959 + F5~153.0612244897959 + A4~153.0612244897959,
153.0612244897959: D4/153.0612244897959 + F4^153.0612244897959 + C4-153.0612244897959 + A5~153.0612244897959 + G5~153.0612244897959,
153.0612244897959: F4^153.0612244897959 + C4-153.0612244897959 + G5^153.0612244897959,
153.0612244897959: C4-153.0612244897959 + G5^153.0612244897959 + A4~153.0612244897959,
153.0612244897959: D4/153.0612244897959 + C4-153.0612244897959 + A5~153.0612244897959 + G5~153.0612244897959 + A4~153.0612244897959,
153.0612244897959: E4/153.0612244897959 + D4~153.0612244897959 + G5~153.0612244897959 + F5~153.0612244897959 + A4~153.0612244897959,
153.0612244897959: F4/153.0612244897959 + G4^153.0612244897959 + D4~153.0612244897959 + G5~153.0612244897959 + A5~153.0612244897959,
153.0612244897959: E4/153.0612244897959 + G4^153.0612244897959 + A4^153.0612244897959 + C4-153.0612244897959 + G5^153.0612244897959,
153.0612244897959: C4-153.0612244897959 + G5^153.0612244897959,
153.0612244897959: F4/153.0612244897959 + D4~153.0612244897959 + A5~153.0612244897959 + G5~153.0612244897959,
153.0612244897959: G4/153.0612244897959 + D4~153.0612244897959 + G5~153.0612244897959 + F5~153.0612244897959,
153.0612244897959: A4/153.0612244897959 + B4^153.0612244897959 + C4-153.0612244897959 + G5~153.0612244897959 + A5~153.0612244897959,
153.0612244897959: G4/153.0612244897959 + B4^153.0612244897959 + C5^153.0612244897959 + C4-153.0612244897959 + G5^153.0612244897959,
153.0612244897959: D4~153.0612244897959 + G5^153.0612244897959,
153.0612244897959: A4/153.0612244897959 + D4~153.0612244897959 + G5^153.0612244897959,
153.0612244897959: B4/153.0612244897959 + C4-153.0612244897959,
153.0612244897959: B4/153.0612244897959 + C5^153.0612244897959 + D4~153.0612244897959 + G5^153.0612244897959,
153.0612244897959: A4/153.0612244897959 + C5^153.0612244897959 + D5^153.0612244897959 + D4~153.0612244897959 + G5^153.0612244897959,
153.0612244897959: A4/153.0612244897959 + C4-153.0612244897959 + G5^153.0612244897959,
153.0612244897959: B4/153.0612244897959 + C4-153.0612244897959,
153.0612244897959: B4/153.0612244897959 + C4-153.0612244897959,
153.0612244897959: A4/153.0612244897959 + D4~153.0612244897959,
153.0612244897959: E5^153.0612244897959 + D4~153.0612244897959 + A5~153.0612244897959 + G5~153.0612244897959,
153.0612244897959: C5/153.0612244897959 + D5/153.0612244897959 + E5^153.0612244897959 + F5^153.0612244897959 + C4-153.0612244897959,
153.0612244897959: D5/153.0612244897959 + E5/153.0612244897959 + C4-153.0612244897959 + A5~153.0612244897959 + G5~153.0612244897959,
153.0612244897959: E5/153.0612244897959 + G5^153.0612244897959 + D4~153.0612244897959,
153.0612244897959: F5/153.0612244897959 + G5^153.0612244897959 + A5^153.0612244897959 + D4~153.0612244897959,
153.0612244897959: A5/153.0612244897959 + C4-153.0612244897959 + A4/153.0612244897959 + G4/153.0612244897959,
153.0612244897959: B5/153.0612244897959 + E5/153.0612244897959 + D5/153.0612244897959 + C4-153.0612244897959 + G4/153.0612244897959`
const playback = playTune(melody, Infinity)
         
  setLegend(
  [ player, bitmap`
44444D44444D4444
44444D44444DD444
444DD444444DD4D4
4444DD44444444DD
4444444444444444
4444444444444444
D4D444444444444D
4D444CCC44D4444D
4D444CC064444444
44444C6644DD4444
44444C8444444444
444448888444D444
4D4D4888444DD44D
4D444LLL44DD444D
44D444L4444D4444
444444LL44444444` ],
  [ fruit, bitmap`
4444D4444D444D44
44DDD444444D4D44
44DD44444444D444
4444444444444444
4444444DD4DD4444
4444444DDDDD4444
44444499DDD44444
44444929999944.4
4444992999994444
4444999999994444
4444999999994444
44D449999991144D
44D444999911144D
DD44444111144D44
4D444444444444D4
444444DD44444444`],
  [ basket, bitmap`
4DDD444444444D44
44DD4444DD444DD4
4444DD44DD944444
44499D4499944DD4
4492999499999944
4C1C1C1CC1C1C1C4
4C1C1C1CC1C1C1C4
4C1C1C1CC1C1C1C4
4C1C1CCCCCC1C1C4
4CCCC1CCCC1CCCC4
44C1C1CCCC1C1C44
44C1CC1CC1CC1C44
44CC1C1CC1C1CC4D
D44C1C1CC1C1C4DD
DLLCCCCCCCCCCLL4
4LLLLLLLLLLLLLL4`],
  [ fence, bitmap `
4444444444444444
4444444444444444
44C444C444C444C4
4CCC4CCC4CCC4CCC
4CCC4CCC4CCC4CCC
CCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCC
4CCC4CCC4CCC4CCC
4CCC4CCC4CCC4CCC
CCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCC
4CCC4CCC4CCC4CCC
4CCC4CCC4CCC4CCC
CCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCC
4CCC4CCC4CCC4CCC`],
  [ grass, bitmap`
4444444444444444
4444444444444444
444D4D44444444D4
4D4DD444444444D4
44D44444444444D4
4444444444444D44
44444444444444D4
4444444444444444
4444444444444444
444444D4D4444444
444444D44D444444
4444444DD4444444
444D44444444444D
4D4D444444444444
44D44444444444D4
444444444444444D`]
  );


  let level = 0; 
  const levels = [
  map`
rprgggggg
rgrrrgggg
rgggrrrrr
rggggrrrg
rgggggggg
rggfgggbg
rgggggggg
rrrrrrrrr`,
  map`
gggrrrrrr
rbgrrrrrr
rgggrrrrr
rggggrrrr
rrggggrrr
rrrggggrr
rrrrgfggr
rrrrrgpgg`,
  map`
rbrrgggggg
rgrggfgggg
rgrggrgggg
gggggrrrrg
gggggggbrg
ggfggrrrrg
gggggggggg
gggggggggg
prrrrrrrrr`,
  map `
rggggrrr
rbgggggr
rrrrrggr
rrrggfgr
rgggfggr
rbgggggr
rrrrrgpr`,
  map`
brrggrrgggb
grrfgggggrr
gggggggggrr
ggrrgggggfg
rggggrrgggg
rrrggggrggg
ggrrgggrggg
gggggggrgfg
ggrggggrggg
pgrggbrrrrr`
  ];


  
const currentLevel = levels[level];
setMap(levels[level]);

setPushables({
  [ player ]: [fruit],
  [fruit]: [fruit]
})

setSolids([player,fruit,fence]);

onInput("s", () => {
  getFirst(player).y += 1; // positive y is downwards
});

onInput("d", () => {
  getFirst(player).x += 1;
});

  onInput("w", () => {
  getFirst(player).y += -1; // positive y is downwards
});

onInput("a", () => {
  getFirst(player).x += -1;
});



onInput("j", () => {
  const currentLevel = levels[level]; 
  if (currentLevel !== undefined) {
    clearText("");
    setMap(currentLevel);
  }
});


afterInput(() => {
   const targetNumber = tilesWith(basket).length;
  const numberCovered = tilesWith(basket, fruit).length;
  if (numberCovered === targetNumber) {
    level = level + 1;
    const currentLevel = levels[level];
    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
      addText("you collected all the stray frut!", { y: 4, color: color`H` });
    }
  }
});